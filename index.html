<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>åœ¨çº¿æŠ•ç¥¨ç³»ç»Ÿ</title>
<style>
body{font-family:system-ui;background:#f9f7f0;margin:0;padding:40px}
.container{max-width:800px;margin:0 auto;background:#fff;border-radius:24px;box-shadow:0 10px 30px rgba(0,0,0,.05);overflow:hidden}
.header{background:linear-gradient(135deg,#4a9c8d 0%,#3a7a6e 100%);color:#fff;padding:40px 30px;text-align:center}
.header h1{font-size:2.5em;margin-bottom:10px}
.content{padding:40px 30px}
.question{font-size:1.6em;color:#3a7a6e;margin-bottom:30px;text-align:center;font-weight:600}
.options{display:grid;gap:18px;margin-bottom:30px}
.option{background:#fff;border:2px solid #e0e8e5;border-radius:16px;padding:20px;cursor:pointer;transition:all .3s ease}
.option:hover{border-color:#4a9c8d;transform:translateY(-3px)}
.option.selected{border-color:#4a9c8d;background:rgba(74,156,141,.08)}
.submit-btn{background:linear-gradient(135deg,#4a9c8d 0%,#3a7a6e 100%);color:#fff;border:none;padding:16px 45px;font-size:1.1em;border-radius:30px;cursor:pointer;display:block;margin:0 auto;transition:all .3s ease;font-weight:600}
.submit-btn:disabled{background:#c8d5d2;cursor:not-allowed}
#votingMessage,#resultsMessage{height:60px}
.result-item{margin-bottom:25px;background:#fff;border-radius:16px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.03)}
.result-header{display:flex;justify-content:space-between;margin-bottom:12px}
.progress-bar{background:#e0e8e5;height:22px;border-radius:12px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#4a9c8d 0%,#8ab9b0 100%);border-radius:12px;transition:width .8s}
.total-votes{text-align:center;margin-top:30px;padding:25px;background:linear-gradient(135deg,rgba(74,156,141,.08) 0%,rgba(138,185,176,.08) 100%);border-radius:16px;color:#3a7a6e;font-weight:600}
.message{padding:12px 16px;border-radius:8px;margin-bottom:15px;font-weight:500}
.message.success{background:#d4edda;color:#155724}
.message.error{background:#f8d7da;color:#721c24}
</style>
</head>
<body>
<div class="container">
  <div class="header"><h1>ğŸ—³ï¸ åœ¨çº¿æŠ•ç¥¨ç³»ç»Ÿ</h1><p>GitHub åç«¯ Â· å®æ—¶ç»“æœ</p></div>
  <div class="content">
    <div id="votingSection" class="voting-section active">
      <div id="votingMessage"></div>
      <div class="question">ä½ æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ</div>
      <div class="options">
        <div class="option" onclick="selectOption(this,'javascript')"><input type="radio" name="vote" value="javascript" id="js"><label for="js" class="option-label">JavaScript</label></div>
        <div class="option" onclick="selectOption(this,'python')"><input type="radio" name="vote" value="python" id="py"><label for="py" class="option-label">Python</label></div>
        <div class="option" onclick="selectOption(this,'java')"><input type="radio" name="vote" value="java" id="ja"><label for="ja" class="option-label">Java</label></div>
        <div class="option" onclick="selectOption(this,'csharp')"><input type="radio" name="vote" value="csharp" id="cs"><label for="cs" class="option-label">C#</label></div>
        <div class="option" onclick="selectOption(this,'cpp')"><input type="radio" name="vote" value="cpp" id="cp"><label for="cp" class="option-label">C++</label></div>
      </div>
      <button id="submitBtn" class="submit-btn" onclick="submitVote()">æäº¤æŠ•ç¥¨</button>
      <p style="text-align:center;margin-top:15px"><a href="javascript:showResults()">æŸ¥çœ‹ç»“æœ</a></p>
    </div>
    <div id="resultsSection" class="results-section">
      <div id="resultsMessage"></div>
      <h2 style="text-align:center;margin-bottom:25px">æŠ•ç¥¨ç»“æœ</h2>
      <div id="resultsContainer"></div>
      <div class="total-votes" id="totalVotes"></div>
      <p style="text-align:center;margin-top:20px"><a href="javascript:location.reload()">è¿”å›æŠ•ç¥¨</a></p>
    </div>
  </div>
</div>

<script>
/* ===== æ”¹æˆä½ è‡ªå·±çš„ ===== */
const OWNER = 'ä½ çš„GitHubç”¨æˆ·å';
const REPO  = 'ä½ çš„ä»“åº“å';
const TOKEN = 'ghp_xxxxxxxx';  // æœ‰ repo æƒé™çš„ Personal Access Token
const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/dispatches`;
const RAW_URL = `https://raw.githubusercontent.com/${OWNER}/${REPO}/main/vote.json`;

/* ===== ç•Œé¢æ§åˆ¶ ===== */
function selectOption(el,val){
  document.querySelectorAll('.option').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById(val.substr(0,2)).checked=true;
}
function showMessage(id,txt,type){
  const m=document.getElementById(id);
  m.innerHTML=`<div class="message ${type}">${txt}</div>`;
  setTimeout(()=>m.innerHTML='',3000);
}
function showResults(){
  document.getElementById('votingSection').classList.remove('active');
  document.getElementById('resultsSection').classList.add('active');
  loadResults();
}

/* ===== æŠ•ç¥¨ ===== */
async function submitVote(){
  const sel=document.querySelector('input[name="vote"]:checked');
  if(!sel){showMessage('votingMessage','è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹','error');return;}
  showMessage('votingMessage','æŠ•ç¥¨ä¸­...','success');
  try{
    await fetch(API_URL,{
      method:'POST',
      headers:{
        'Accept':'application/vnd.github+json',
        'Authorization':`token ${TOKEN}`,
        'Content-Type':'application/json'
      },
      body:JSON.stringify({
        event_type:'vote',
        client_payload:{data:JSON.stringify({[sel.value]:1})}
      })
    });
    showMessage('votingMessage','æŠ•ç¥¨æˆåŠŸï¼','success');
    document.getElementById('submitBtn').disabled=true;
    setTimeout(showResults,1200);
  }catch(e){showMessage('votingMessage','å‡ºé”™ï¼Œç¨åå†è¯•','error');}
}

/* ===== è¯»ç»“æœ ===== */
async function loadResults(){
  const res=await fetch(RAW_URL),data=await res.json();
  const total=Object.values(data).reduce((a,b)=>a+b,0);
  const arr=Object.entries(data).map(([k,v])=>({
    key:k,name:{javascript:'JavaScript',python:'Python',java:'Java',csharp:'C#',cpp:'C++'}[k],
    count:v,percentage:total?(v/total*100).toFixed(1):0
  })).sort((a,b)=>b.count-a.count);
  document.getElementById('resultsContainer').innerHTML=arr.map(r=>`
    <div class="result-item">
      <div class="result-header"><span class="result-label">${r.name}</span><span>${r.count} ç¥¨ Â· ${r.percentage}%</span></div>
      <div class="progress-bar"><div class="progress-fill" style="width:${r.percentage}%"></div></div>
    </div>`).join('');
  document.getElementById('totalVotes').textContent=`æ€»æŠ•ç¥¨æ•°ï¼š${total} ç¥¨`;
}
</script>
</body>
</html>
